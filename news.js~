<!DOCTYPE html>
<html>

  <head>
    <title>News</title>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script>
      $(document).ready(function(){

      var transition = ["therefore, ", "although, ", "<br> ", "and then,",  " I suppose. ", " but then ", " ", " despite that, ", " "];
      $("#first").datepicker();
      $("#second").datepicker();
      $("#date").click( function date( ){

      var searchTerm = "";

      var words = $("#keyword").val();
      if(words != ""){
      searchTerm += ("q="+words + "&");
      }

      var firstDate = $("#first").datepicker("getDate" );
      var firstFormatDate = $.datepicker.formatDate("yymmdd", firstDate);
      if(firstFormatDate != ""){
      searchTerm = searchTerm + "begin_date=" + firstFormatDate + "&";
      console.log(Number(firstFormatDate));
      }

      var secondDate = $("#second").datepicker("getDate");
      var secondFormatDate = $.datepicker.formatDate("yymmdd", secondDate);
      if(secondFormatDate != ""){
      searchTerm += ("end_date=" + secondFormatDate + "&");
      console.log(Number(secondFormatDate));
      }
      

      if(searchTerm == ""){
      alert("Gotta enter something!");
      return;
      }
      //console.log($.datepicker.formatDate("yymmdd", firstDate));

      $.ajax({

      url:"http://api.nytimes.com/svc/search/v2/articlesearch.json?"+searchTerm+"api-key=8d8f8feb8c9291d8c8b6e2d9fb712192:19:54406938",
      //url:"http://api.nytimes.com/svc/search/v2/articlesearch.json?q="+words+"&begin_date="+firstFormatDate+"&end_date="+secondFormatDate+"&api-key=8d8f8feb8c9291d8c8b6e2d9fb712192:19:54406938",

      method:"GET",
      dataType:"json"
      }).done(function(data){
      if(data.response.meta.hits == 0)
      alert("Darn, no hits!");

      var titles = "";
      var map = {Obama:"The Boss", Clinton:"The Woman"};

      $.each(data.response.docs, function(index, value){
      var newTitle = value.snippet.replace(/Clinton|Obama/ig , function(matched){
      return map[matched];

      });

      titles += (newTitle + transition[Math.round(Math.random()*(transition.length-1))]);
      //document.write(newTitle); 
      //document.write(transition[Math.round(Math.random()*(transition.length-1))]);

      });
      document.getElementById("loadDate").innerHTML = titles;

      });
      });

      $("#top").click( function topStory(){
      $.ajax({
      url: "http://api.nytimes.com/svc/topstories/v1/home.json?api-key=013683ddcb4ae91ce5f192f4702eee80:0:54406938",
      method: "GET",
      dataType: "json"
      }).done(function(data){
      
      var titles = "";
      $.each(data.results, function(index, value){
 
      var map = {Obama:"The Boss", Clinton:"The Woman", Bush:"the maverick"};
      var newTitle = value.title.replace(/Clinton|Obama|Bush/ig , function(matched){
      return map[matched];
      });
      titles += (newTitle + ", " + transition[Math.round(Math.random()*(transition.length-1))]);

      //document.write(newTitle);
      //document.write(",\n");
      //document.write(transition[Math.round(Math.random()*(transition.length-1))]);
      });
      document.getElementById("loadTop").innerHTML = titles;

      $("#reload").click(function( ) {
      location.reload();
      });

      });
      });
      });

    </script>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Your daily brief</h1>
    </section>
    <section class="main-content">
      <div id="header">
	<h1><br/>All the finest news</h1>
      </div>
      <p> Get news stories from <input type="text" id="first"> to <input type="text" id="second"> </p>
      <p>Keywords <input type="text" id="keyword"></p>
      <button id="date">Fetch me some news</button>
      <section id = "loadDate"></section>

      <!--<button id="reload">Reload</button> -->
      <p></p>

      <p>Or read</p>
      <button id="top">Today's top stories</button>
      <section id = "loadTop"></section>
    </section>
  </body>

</html>
